---
import Layout from '@/layouts/Layout.astro';
import { getCollection, getEntryBySlug } from 'astro:content';
import { intro } from '@/lib/data';

const { slug } = Astro.params;
const entry = slug ? await getEntryBySlug('notes', slug) : null;

if (!entry) {
	throw new Error(`Note not found for slug "${slug ?? ''}"`);
}

const { Content } = await entry.render();

export async function getStaticPaths() {
	const entries = await getCollection('notes');
	return entries.map(note => ({ params: { slug: note.slug } }));
}
---
<Layout title={`${entry.data.title} · Notes`} description={entry.data.description}>
	<!-- Top Navigation -->
	<nav class='sticky top-0 z-50 border-b border-border/40 bg-background/95 backdrop-blur'>
		<div class='mx-auto max-w-3xl px-6 py-4'>
			<div class='flex items-center justify-between'>
				<a href='/' class='font-medium text-foreground transition-colors hover:text-muted-foreground'>{intro.name}</a>
				<a href='/notes' class='text-sm text-muted-foreground transition-colors hover:text-foreground'>notes</a>
			</div>
		</div>
	</nav>
	<main class='min-h-screen bg-background'>
		<div class='mx-auto max-w-3xl px-6 py-16 md:py-24'>
			<article class='space-y-8'>
				<header class='space-y-4'>
					<div class='flex items-center gap-3 text-xs text-muted-foreground/70'>
						<span>{entry.data.publishDate.toLocaleDateString()}</span>
						{entry.data.tags && entry.data.tags.length > 0 && (
							<>
								<span>·</span>
								<div class='flex flex-wrap gap-2'>
									{entry.data.tags.map(tag => (
										<span key={tag}>#{tag}</span>
									))}
								</div>
							</>
						)}
					</div>
					<h1 class='text-3xl font-medium tracking-tight md:text-4xl'>{entry.data.title}</h1>
					{entry.data.description && (
						<p class='text-muted-foreground leading-relaxed'>{entry.data.description}</p>
					)}
				</header>
				<div class='prose prose-sm max-w-none text-muted-foreground'>
					<Content />
				</div>
			</article>
		</div>
	</main>
</Layout>
